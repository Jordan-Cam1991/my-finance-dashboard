!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Financial Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (Slate, Zinc, Stone) -->
    <!-- Application Structure Plan: A single-page dashboard design is used to provide a centralized and immediate overview of all key financial data. The structure prioritizes usability through: 1) Top-level Key Metrics for a quick health check. 2) A Tabbed Interface to segment detailed information (Weekly Breakdown, Expenses, Savings Goals, Data Input) without overwhelming the user. This prevents a long, confusing page scroll. The flow encourages starting with a high-level summary, then drilling down into specific areas of interest (e.g., "How is my spending allocated?" or "How is our savings goal progressing?"), and now includes a dedicated tab for easy data input and manipulation, which is a more intuitive user journey than a linear report. -->
    <!-- Visualization & Content Choices: 
        - Key Metrics (Cards): Goal: Inform. Method: Large text in HTML cards. Justification: Provides immediate, high-impact visibility of the most critical numbers.
        - Weekly Breakdown (Bar Chart): Goal: Reflect actual weekly spending. Method: Chart.js Horizontal Bar Chart. Justification: Provides a clear, combined view of income allocation including actual variable spending.
        - Expenses Deep Dive (Bar Chart & Table): Goal: Analyze/Compare. Method: Chart.js Horizontal Bar Chart & HTML Table. Justification: The bar chart is superior to a pie chart for comparing the magnitude of different expense categories. The interactive table allows for detailed inspection and sorting of all fixed costs.
        - Savings Goal (Progress Bar & Line Chart): Goal: Track Change/Progress. Method: HTML/CSS Progress Bar & Chart.js Line Chart. Justification: The progress bar offers a simple, visual cue of completion. The line chart effectively illustrates the projected growth of savings over time, which is highly motivating.
        - Data Input (Form/Textareas): Goal: Manipulate/Update Data. Method: HTML input fields and textareas with JS parsing. Justification: Provides a user-friendly interface for updating the underlying data without needing to edit code, enhancing interactivity and usability for ongoing financial tracking.
        - Library/Method: Chart.js for all charts due to its simplicity, responsiveness, and canvas-based rendering.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 350px;
            }
        }
        .tab-active {
            border-color: #4f46e5; /* indigo-600 */
            color: #4f46e5;
            font-weight: 600;
        }
        .form-label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: #475569; /* slate-600 */
        }
        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #cbd5e1; /* slate-300 */
            border-radius: 0.375rem;
            background-color: #ffffff;
            color: #1e293b; /* slate-900 */
            font-size: 0.875rem;
        }
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Our Financial Dashboard</h1>
            <p class="text-slate-500 mt-2">A clear view of our income, expenses, and savings goals.</p>
        </header>

        <main>
            <!-- Key Metrics -->
            <section id="key-metrics" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 text-center">
                    <h3 class="text-sm md:text-base font-medium text-slate-500">Combined Weekly Income</h3>
                    <p class="text-2xl md:text-3xl font-bold text-green-600 mt-1" id="metric-income">$0.00</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 text-center">
                    <h3 class="text-sm md:text-base font-medium text-slate-500">Total Weekly Expenses</h3>
                    <p class="text-2xl md:text-3xl font-bold text-red-600 mt-1" id="metric-expenses">$0.00</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 text-center">
                    <h3 class="text-sm md:text-base font-medium text-slate-500">Weekly Savings Goal</h3>
                    <p class="text-2xl md:text-3xl font-bold text-blue-600 mt-1" id="metric-savings">$0.00</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 text-center">
                    <h3 class="text-sm md:text-base font-medium text-slate-500">Net Weekly Position</h3>
                    <p class="text-2xl md:text-3xl font-bold text-slate-700 mt-1" id="metric-net">$0.00</p>
                </div>
            </section>

            <nav class="flex border-b border-slate-200 mb-6 overflow-x-auto">
                <button data-tab="weekly" class="tab-button py-3 px-4 md:px-6 border-b-2 tab-active whitespace-nowrap">Weekly Breakdown</button>
                <button data-tab="expenses" class="tab-button py-3 px-4 md:px-6 border-b-2 border-transparent text-slate-500 hover:text-slate-700 whitespace-nowrap">Expenses Deep Dive</button>
                <button data-tab="savings" class="tab-button py-3 px-4 md:px-6 border-b-2 border-transparent text-slate-500 hover:text-slate-700 whitespace-nowrap">Savings Goals</button>
                <button data-tab="data-input" class="tab-button py-3 px-4 md:px-6 border-b-2 border-transparent text-slate-500 hover:text-slate-700 whitespace-nowrap">Data Input</button>
            </nav>

            <div id="tab-content">
                
                <section id="weekly" class="tab-pane">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900">Combined Weekly Summary</h2>
                        <p class="text-slate-500 mt-1">An overview of our household's income and how it's allocated per week.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h3 class="text-xl font-bold text-center">Weekly Financial Allocation</h3>
                            <div class="chart-container mx-auto mt-4 max-w-sm">
                                <canvas id="combinedWeeklyChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-center">
                            <h3 class="text-xl font-bold text-center mb-4">Weekly Financial Position</h3>
                            <ul class="space-y-2 text-sm">
                                <li class="flex justify-between items-center"><span class="font-medium">Combined Net Pay:</span> <span class="font-semibold text-green-600" id="combined-net-pay"></span></li>
                                <li class="flex justify-between items-center"><span class="font-medium">Total Fixed Expenses:</span> <span class="font-semibold text-red-600" id="combined-fixed-expenses"></span></li>
                                <li class="flex justify-between items-center"><span class="font-medium">Total Variable Budget:</span> <span class="font-semibold text-orange-600" id="combined-variable-budget"></span></li>
                                <li class="flex justify-between items-center"><span class="font-medium">Total Actual Variable Spending:</span> <span class="font-semibold text-orange-700" id="combined-actual-variable-spending"></span>
                                    <ul id="weekly-actual-variable-spending-list" class="ml-4 text-xs text-slate-500 list-disc list-inside mt-1 space-y-0.5">
                                        <!-- Actual variable spending items will be listed here -->
                                    </ul>
                                </li>
                                <li class="flex justify-between items-center"><span class="font-medium">Total Savings Contribution:</span> <span class="font-semibold text-blue-600" id="combined-savings-contribution"></span></li>
                                <li class="flex justify-between items-center border-t pt-2 mt-2"><span class="font-bold">Remaining Disposable:</span> <span class="font-bold text-slate-800" id="combined-disposable"></span></li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="expenses" class="tab-pane hidden">
                    <div class="grid lg:grid-cols-5 gap-6">
                        <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                             <h2 class="text-2xl font-bold text-slate-900 mb-1">Fixed Expenses Breakdown</h2>
                             <p class="text-slate-500 mb-4 text-sm">All recurring bills converted to their weekly equivalent for easy comparison.</p>
                             <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-100 text-slate-600">
                                        <tr>
                                            <th class="p-3 font-semibold">Category</th>
                                            <th class="p-3 font-semibold">Provider</th>
                                            <th class="p-3 font-semibold text-right">Weekly Cost</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fixed-expenses-table">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                            <h2 class="text-2xl font-bold text-slate-900 mb-1">Top Spending Categories</h2>
                             <p class="text-slate-500 mb-4 text-sm">A visual look at where most of the money goes each week.</p>
                            <div class="chart-container">
                                <canvas id="expensesBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="savings" class="tab-pane hidden">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-slate-900">30k Savings Goal Tracker</h2>
                        <p class="text-slate-500 mt-1">Our primary savings objective and projected path to success.</p>
                    </div>
                    <div class="grid lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-center">
                            <h3 class="text-lg font-bold mb-4">Goal Progress</h3>
                            <div class="w-full bg-slate-200 rounded-full h-6 mb-2">
                                <div id="progress-bar" class="bg-indigo-600 h-6 rounded-full text-center text-white text-sm flex items-center justify-center font-semibold" style="width: 0%;">0%</div>
                            </div>
                            <ul class="mt-4 space-y-2 text-sm">
                                <li class="flex justify-between"><span class="font-medium text-slate-600">Amount Saved:</span> <span id="savings-current" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium text-slate-600">Target:</span> <span id="savings-target" class="font-bold"></span></li>
                                <li class="flex justify-between"><span class="font-medium text-slate-600">Amount Remaining:</span> <span id="savings-remaining" class="font-bold text-indigo-700"></span></li>
                                <li class="flex justify-between border-t mt-2 pt-2"><span class="font-medium text-slate-600">Est. Completion Date:</span> <span id="savings-eta" class="font-bold"></span></li>
                            </ul>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                             <h3 class="text-lg font-bold mb-2">Projected Growth</h3>
                             <p class="text-sm text-slate-500 mb-4">This chart shows the projected increase in our savings balance over the coming weeks.</p>
                            <div class="chart-container">
                                <canvas id="savingsLineChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="data-input" class="tab-pane hidden">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                        <h2 class="text-2xl font-bold text-slate-900 mb-4">Update Your Financial Data</h2>
                        <!-- Removed introductory text as requested -->

                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-700 mb-3">Income (Weekly Net)</h3>
                                <div class="mb-4">
                                    <label for="input-combined-income" class="form-label">Combined Weekly Net Salary</label>
                                    <input type="number" id="input-combined-income" class="form-input" readonly>
                                </div>
                                <div class="mb-4">
                                    <label for="input-emma-income" class="form-label">Emma's Weekly Net Salary</label>
                                    <input type="number" id="input-emma-income" class="form-input" value="1391">
                                </div>
                                <div class="mb-0">
                                    <label for="input-jordan-income" class="form-label">Jordan's Weekly Net Salary</label>
                                    <input type="number" id="input-jordan-income" class="form-input" value="1797">
                                </div>
                            </div>
                            <!-- Savings Goal inputs moved below Log Actual Weekly Savings -->
                            <div id="savings-goal-input-section">
                                <!-- This section will be moved by JS on load or dynamically -->
                            </div>
                        </div>

                        <!-- Moved Log Actual Weekly Variable Spending to top -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Log Actual Weekly Variable Spending</h3>
                            <p class="text-sm text-slate-500 mb-4">Enter individual variable purchases made this week to track actual spending.</p>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 items-end">
                                <div>
                                    <label for="input-actual-variable-category" class="form-label text-sm">Category</label>
                                    <input type="text" id="input-actual-variable-category" class="form-input text-sm" placeholder="e.g. Groceries">
                                </div>
                                <div>
                                    <label for="input-actual-variable-amount" class="form-label text-sm">Amount</label>
                                    <input type="number" id="input-actual-variable-amount" class="form-input text-sm" placeholder="e.g. 75">
                                </div>
                                <div>
                                    <label for="input-actual-variable-date" class="form-label text-sm">Date (Optional)</label>
                                    <input type="date" id="input-actual-variable-date" class="form-input text-sm">
                                </div>
                                <div class="flex items-end">
                                    <button type="button" id="add-actual-variable-spending-button" class="bg-blue-600 text-white py-2 px-4 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out w-full">
                                        Log Spending
                                    </button>
                                </div>
                            </div>
                            <div id="actual-variable-spending-log-display" class="mt-4 p-3 bg-slate-100 rounded-md max-h-40 overflow-y-auto text-sm text-slate-600">
                                <p class="text-center text-slate-400" id="no-actual-variable-spending-message">No actual variable spending logged yet this week.</p>
                                <ul id="actual-variable-spending-list" class="space-y-1">
                                    <!-- Logged entries will appear here -->
                                </ul>
                            </div>
                            <button type="button" id="reset-variable-spending-button" class="mt-4 bg-red-500 text-white py-2 px-4 rounded-lg shadow hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition duration-150 ease-in-out">
                                Reset Weekly Variable Spending
                            </button>
                        </div>
                        <!-- End new section -->

                        <!-- Log Actual Weekly Savings moved here -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Log Actual Weekly Savings</h3>
                            <p class="text-sm text-slate-500 mb-4">Add the amount you actually saved this week to update your total progress.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end">
                                <div>
                                    <label for="input-weekly-actual-amount" class="form-label text-sm">Amount Saved This Week</label>
                                    <input type="number" id="input-weekly-actual-amount" class="form-input text-sm" placeholder="e.g. 550">
                                </div>
                                <div>
                                    <label for="input-weekly-actual-date" class="form-label text-sm">Date of Saving (Optional)</label>
                                    <input type="date" id="input-weekly-actual-date" class="form-input text-sm">
                                </div>
                                <div class="flex items-end">
                                    <button type="button" id="add-actual-saving-button" class="bg-blue-600 text-white py-2 px-4 rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out w-full">
                                        Log Saving
                                    </button>
                                </div>
                            </div>
                            <div id="actual-savings-log-display" class="mt-4 p-3 bg-slate-100 rounded-md max-h-40 overflow-y-auto text-sm text-slate-600">
                                <p class="text-center text-slate-400" id="no-actuals-message">No actual savings logged yet.</p>
                                <ul id="actual-savings-list" class="space-y-1">
                                    <!-- Logged entries will appear here -->
                                </ul>
                            </div>
                        </div>
                        <!-- End moved section -->

                        <!-- Savings Goal (30k Goal) moved here from above -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Savings Goal (30k Goal)</h3>
                            <div class="mb-4">
                                <label for="input-savings-current" class="form-label">Current Savings</label>
                                <input type="number" id="input-savings-current" class="form-input" value="21900">
                            </div>
                            <div class="mb-4">
                                <label for="input-savings-target" class="form-label">Target Savings</label>
                                <input type="number" id="input-savings-target" class="form-input" value="30000">
                            </div>
                            <div class="mb-4">
                                <label for="input-weekly-contribution" class="form-label">Weekly Contribution</label>
                                <input type="number" id="input-weekly-contribution" class="form-input" value="700">
                            </div>
                            <div class="mb-0">
                                <label for="input-savings-start-date" class="form-label">Start Date (YYYY-MM-DD)</label>
                                <input type="date" id="input-savings-start-date" class="form-input"> 
                            </div>

                            <!-- New: Log Savings Used -->
                            <h4 class="text-md font-semibold text-slate-700 mt-6 mb-3">Log Savings Used</h4>
                            <p class="text-sm text-slate-500 mb-4">Record instances where savings were withdrawn or used for specific purposes.</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 items-end">
                                <div>
                                    <label for="input-savings-used-amount" class="form-label text-sm">Amount Used</label>
                                    <input type="number" id="input-savings-used-amount" class="form-input text-sm" placeholder="e.g. 200">
                                </div>
                                <div>
                                    <label for="input-savings-used-reason" class="form-label text-sm">Reason</label>
                                    <input type="text" id="input-savings-used-reason" class="form-input text-sm" placeholder="e.g. Emergency repair">
                                </div>
                                <div>
                                    <label for="input-savings-used-date" class="form-label text-sm">Date (Optional)</label>
                                    <input type="date" id="input-savings-used-date" class="form-input text-sm">
                                </div>
                                <div class="flex items-end md:col-span-3">
                                    <button type="button" id="add-savings-used-button" class="bg-yellow-600 text-white py-2 px-4 rounded-lg shadow hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-opacity-50 transition duration-150 ease-in-out w-full">
                                        Log Savings Used
                                    </button>
                                </div>
                            </div>
                            <div id="actual-savings-used-log-display" class="mt-4 p-3 bg-slate-100 rounded-md max-h-40 overflow-y-auto text-sm text-slate-600">
                                <p class="text-center text-slate-400" id="no-savings-used-message">No savings used logged yet.</p>
                                <ul id="actual-savings-used-list" class="space-y-1">
                                    <!-- Logged uses will appear here -->
                                </ul>
                            </div>
                        </div>
                        <!-- End moved Savings Goal section -->

                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-slate-700 mb-3">Fixed Expenses</h3>
                            <div id="fixed-expenses-inputs-container">
                                <!-- Fixed expense rows will be added here by JavaScript -->
                            </div>
                            <button type="button" id="add-fixed-expense-button" class="mt-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out">
                                + Add Fixed Expense
                            </button>
                        </div>

                        <button id="update-dashboard-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition duration-150 ease-in-out">
                            Update Dashboard
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const formatCurrency = (value) => new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD' }).format(value);
            const formatDate = (date) => {
                if (!(date instanceof Date) || isNaN(date)) {
                    return 'N/A';
                }
                return date.toLocaleDateString('en-AU', { day: 'numeric', month: 'short', year: 'numeric'});
            };

            let currentData = {}; 

            const getWeeklyAmount = (amount, freq) => {
                switch (freq.toLowerCase()) {
                    case 'weekly': return amount;
                    case 'fortnightly': return amount / 2;
                    case 'monthly': return amount / 4.33; 
                    case 'quarterly': return amount / 13; 
                    case 'yearly': return amount / 52;
                    default: return 0;
                }
            };

            const defaultData = {
                income: {
                    emma: 1391,
                    jordan: 1797,
                    combined: 3188 
                },
                fixedExpenses: [
                    { category: 'Streaming', provider: 'Spotify', amount: 5, freq: 'Weekly' },
                    { category: 'Internet', provider: 'Telstra', amount: 24, freq: 'Monthly' },
                    { category: 'Mobile', provider: 'Optus', amount: 36.5, freq: 'Monthly' },
                    { category: 'Transport', provider: 'Tolls', amount: 36, freq: 'Weekly' },
                    { category: 'Loan', provider: 'Car Repayment', amount: 100, freq: 'Monthly' },
                    { category: 'Insurance', provider: 'Emma Car Insurance', amount: 52, freq: 'Monthly' },
                    { category: 'Insurance', provider: 'Jordan Car Insurance', amount: 22, freq: 'Yearly' },
                    { category: 'Utilities', provider: 'Water', amount: 40, freq: 'Quarterly' },
                    { category: 'Utilities', provider: 'Electricity', amount: 80, freq: 'Quarterly' },
                    { category: 'Utilities', provider: 'Solar', amount: 40, freq: 'Monthly' },
                    { category: 'Housing', provider: 'Rates', amount: 80, freq: 'Quarterly' },
                    { category: 'Housing', provider: 'Mortgage', amount: 1211, freq: 'Fortnightly' },
                    { category: 'Transport', provider: 'Petrol', amount: 40, freq: 'Weekly' },
                    { category: 'Health', provider: 'Health Care', amount: 83, freq: 'Monthly' }, 
                    { category: 'Utilities', provider: 'Gas', amount: 10, freq: 'Quarterly' },
                    { category: 'Streaming', provider: 'Netflix', amount: 3, freq: 'Monthly' },
                    { category: 'Streaming', provider: 'Kayo', amount: 10, freq: 'Monthly' },
                    { category: 'Insurance', provider: 'Home Insurance', amount: 36, freq: 'Yearly' },
                    { category: 'Pets', provider: 'Cat Food / Litter', amount: 45, freq: 'Monthly' },
                    { category: 'Health', provider: 'Gym', amount: 35, freq: 'Weekly' }, // Moved from variable expenses
                    { category: 'Charity', provider: 'Charity', amount: 10, freq: 'Weekly' } // Moved from variable expenses
                ],
                variableExpenses: [
                    { name: 'Groceries', budget: 300 },
                    { name: 'Dining Out', budget: 50 },
                    { name: 'Entertainment', budget: 30 },
                    { name: 'Personal Care', budget: 20 },
                    { name: 'Shopping', budget: 40 },
                    { name: 'Transport (Other)', budget: 10 },
                    { name: 'Hobbies', budget: 15 },
                    { name: 'Miscellaneous', budget: 25 }
                ],
                savingsGoal: {
                    name: '30k Goal',
                    startDate: new Date().toISOString().split('T')[0], 
                    current: 21900, 
                    target: 30000,
                    weeklyContribution: 700,
                    actualSavingsLog: [],
                    actualSavingsUsedLog: [] // New log for used savings
                },
                actualVariableSpendingLog: [] 
            };


            let combinedWeeklyChart, expensesBarChart, savingsLineChart; 

            function updateRowWeeklyDisplay(rowDiv) {
                const amountInput = rowDiv.querySelector('.fixed-expense-amount');
                const freqSelect = rowDiv.querySelector('.fixed-expense-freq');
                const weeklyDisplay = rowDiv.querySelector('.fixed-expense-weekly-display');

                const amount = parseFloat(amountInput.value) || 0;
                const freq = freqSelect.value;
                const weeklyValue = getWeeklyAmount(amount, freq);
                weeklyDisplay.textContent = formatCurrency(weeklyValue);
            }

            function createFixedExpenseRow(category = '', provider = '', amount = '', freq = 'Weekly') {
                const container = document.getElementById('fixed-expenses-inputs-container');
                const rowDiv = document.createElement('div');
                rowDiv.className = 'fixed-expense-row grid grid-cols-1 sm:grid-cols-5 gap-4 mb-3 items-end p-3 border border-slate-200 rounded-md bg-slate-50';

                rowDiv.innerHTML = `
                    <div>
                        <label class="form-label text-sm">Category</label>
                        <input type="text" class="form-input text-sm fixed-expense-category" placeholder="e.g. Utilities" value="${category}">
                    </div>
                    <div>
                        <label class="form-label text-sm">Provider</label>
                        <input type="text" class="form-input text-sm fixed-expense-provider" placeholder="e.g. Spotify" value="${provider}">
                    </div>
                    <div>
                        <label class="form-label text-sm">Amount</label>
                        <input type="number" class="form-input text-sm fixed-expense-amount" placeholder="e.g. 50" value="${amount}">
                    </div>
                    <div>
                        <label class="form-label text-sm">Frequency</label>
                        <select class="form-input text-sm fixed-expense-freq form-select">
                            ${['Weekly', 'Fortnightly', 'Monthly', 'Quarterly', 'Yearly'].map(f => `<option value="${f}" ${f === freq ? 'selected' : ''}>${f}</option>`).join('')}
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label class="form-label text-sm">Weekly Cost</label>
                        <span class="text-sm font-semibold text-slate-700 mt-1 fixed-expense-weekly-display"></span>
                        <button type="button" class="remove-fixed-expense-row bg-red-500 text-white p-2 rounded-md hover:bg-red-600 w-full mt-2">Remove</button>
                    </div>
                `;

                container.appendChild(rowDiv);

                const amountInput = rowDiv.querySelector('.fixed-expense-amount');
                const freqSelect = rowDiv.querySelector('.fixed-expense-freq');
                
                amountInput.addEventListener('input', () => updateRowWeeklyDisplay(rowDiv));
                freqSelect.addEventListener('change', () => updateRowWeeklyDisplay(rowDiv));
                rowDiv.querySelector('.remove-fixed-expense-row').addEventListener('click', () => {
                    rowDiv.remove();
                });

                updateRowWeeklyDisplay(rowDiv); // Initial update for the new row
            }

            function populateFixedExpensesInputs(fixedExpenses) {
                const container = document.getElementById('fixed-expenses-inputs-container');
                container.innerHTML = ''; 
                if (fixedExpenses.length === 0) {
                    for (let i = 0; i < 3; i++) {
                        createFixedExpenseRow();
                    }
                } else {
                    fixedExpenses.forEach(expense => {
                        createFixedExpenseRow(expense.category, expense.provider, expense.amount, expense.freq);
                    });
                }
            }

            function updateCombinedIncomeInput() {
                const emmaIncome = parseFloat(document.getElementById('input-emma-income').value) || 0;
                const jordanIncome = parseFloat(document.getElementById('input-jordan-income').value) || 0;
                document.getElementById('input-combined-income').value = emmaIncome + jordanIncome;
            }

            function populateSavingsGoalInputs(savingsGoal) {
                document.getElementById('input-savings-current').value = savingsGoal.current;
                document.getElementById('input-savings-target').value = savingsGoal.target;
                document.getElementById('input-weekly-contribution').value = savingsGoal.weeklyContribution;
                document.getElementById('input-savings-start-date').value = savingsGoal.startDate || new Date().toISOString().split('T')[0];
            }

            function renderActualSavingsLog() {
                const list = document.getElementById('actual-savings-list');
                const noMessage = document.getElementById('no-actuals-message');
                list.innerHTML = ''; // Clear existing list items

                if (!currentData.savingsGoal.actualSavingsLog || currentData.savingsGoal.actualSavingsLog.length === 0) {
                    noMessage.classList.remove('hidden');
                } else {
                    noMessage.classList.add('hidden');
                    // Sort descending by date for display (most recent first)
                    const sortedLogs = [...currentData.savingsGoal.actualSavingsLog].sort((a, b) => new Date(b.date) - new Date(a.date)); 
                    sortedLogs.forEach(entry => {
                        const li = document.createElement('li');
                        li.textContent = `${formatDate(new Date(entry.date))}: ${formatCurrency(entry.amount)}`;
                        list.appendChild(li);
                    });
                }
            }

            function renderActualSavingsUsedLog() {
                const list = document.getElementById('actual-savings-used-list');
                const noMessage = document.getElementById('no-savings-used-message');
                list.innerHTML = ''; 

                if (!currentData.savingsGoal.actualSavingsUsedLog || currentData.savingsGoal.actualSavingsUsedLog.length === 0) {
                    noMessage.classList.remove('hidden');
                } else {
                    noMessage.classList.add('hidden');
                    const sortedLogs = [...currentData.savingsGoal.actualSavingsUsedLog].sort((a, b) => new Date(b.date) - new Date(a.date)); 
                    sortedLogs.forEach(entry => {
                        const li = document.createElement('li');
                        li.textContent = `${formatDate(new Date(entry.date))} - ${entry.reason}: ${formatCurrency(entry.amount)}`;
                        list.appendChild(li);
                    });
                }
            }

            function renderActualVariableSpendingLog() {
                const dataInputList = document.getElementById('actual-variable-spending-list');
                const weeklyBreakdownList = document.getElementById('weekly-actual-variable-spending-list'); // New
                const noMessageDataInput = document.getElementById('no-actual-variable-spending-message');
                
                dataInputList.innerHTML = ''; 
                weeklyBreakdownList.innerHTML = ''; // Clear both lists

                if (!currentData.actualVariableSpendingLog || currentData.actualVariableSpendingLog.length === 0) {
                    noMessageDataInput.classList.remove('hidden');
                } else {
                    noMessageDataInput.classList.add('hidden');
                    const sortedLogs = [...currentData.actualVariableSpendingLog].sort((a, b) => new Date(b.date) - new Date(a.date)); 
                    sortedLogs.forEach(entry => {
                        const liDataInput = document.createElement('li');
                        liDataInput.textContent = `${formatDate(new Date(entry.date))} - ${entry.category}: ${formatCurrency(entry.amount)}`;
                        dataInputList.appendChild(liDataInput);

                        const liWeeklyBreakdown = document.createElement('li');
                        liWeeklyBreakdown.textContent = `${entry.category}: ${formatCurrency(entry.amount)}`;
                        weeklyBreakdownList.appendChild(liWeeklyBreakdown);
                    });
                }
            }


            function parseInputData() {
                const parsed = {};

                parsed.income = {
                    emma: parseFloat(document.getElementById('input-emma-income').value) || 0,
                    jordan: parseFloat(document.getElementById('input-jordan-income').value) || 0
                };
                parsed.income.combined = parsed.income.emma + parsed.income.jordan;

                parsed.savingsGoal = {
                    name: 'Custom Goal', 
                    startDate: document.getElementById('input-savings-start-date').value || new Date().toISOString().split('T')[0],
                    current: parseFloat(document.getElementById('input-savings-current').value) || 0,
                    target: parseFloat(document.getElementById('input-savings-target').value) || 0,
                    weeklyContribution: parseFloat(document.getElementById('input-weekly-contribution').value) || 0,
                    actualSavingsLog: currentData.savingsGoal.actualSavingsLog || [],
                    actualSavingsUsedLog: currentData.savingsGoal.actualSavingsUsedLog || [] 
                };

                parsed.fixedExpenses = [];
                document.querySelectorAll('.fixed-expense-row').forEach(rowDiv => {
                    const categoryInput = rowDiv.querySelector('.fixed-expense-category'); 
                    const providerInput = rowDiv.querySelector('.fixed-expense-provider'); 
                    const amountInput = rowDiv.querySelector('.fixed-expense-amount');
                    const freqSelect = rowDiv.querySelector('.fixed-expense-freq');

                    const category = categoryInput ? categoryInput.value.trim() : ''; 
                    const provider = providerInput ? providerInput.value.trim() : ''; 
                    const amount = amountInput ? parseFloat(amountInput.value) : NaN;
                    const freq = freqSelect ? freqSelect.value : 'Weekly';

                    if (category && provider && !isNaN(amount) && amount >= 0) { 
                        parsed.fixedExpenses.push({ category, provider, amount, freq }); 
                    } else if (category || provider || !isNaN(amount)) { 
                        console.warn('Skipping partially filled/invalid fixed expense row:', { category, provider, amount, freq });
                    }
                });

                // Variable expenses budget list is now static from defaultData
                parsed.variableExpenses = defaultData.variableExpenses; 

                // Actual variable spending log is directly managed by its logging functions
                parsed.actualVariableSpendingLog = currentData.actualVariableSpendingLog || [];

                return parsed;
            }

            function processAndRenderData(dataToUse) {
                currentData = dataToUse; 

                const processed = {
                    fixedExpensesWeekly: currentData.fixedExpenses.map(e => ({
                        category: e.category, 
                        provider: e.provider, 
                        weekly: getWeeklyAmount(e.amount, e.freq)
                    })),
                    get totalFixedWeekly() { return this.fixedExpensesWeekly.reduce((sum, e) => sum + e.weekly, 0); },
                    get totalVariableBudget() { return currentData.variableExpenses.reduce((sum, e) => sum + e.budget, 0); }, 
                    get totalActualVariableSpending() { return currentData.actualVariableSpendingLog.reduce((sum, e) => sum + e.amount, 0); }, 
                    get totalExpensesWeekly() { return this.totalFixedWeekly + this.totalActualVariableSpending; }, 
                };

                // Update Key Metrics
                document.getElementById('metric-income').textContent = formatCurrency(currentData.income.combined);
                document.getElementById('metric-expenses').textContent = formatCurrency(processed.totalFixedWeekly + processed.totalActualVariableSpending); 
                document.getElementById('metric-savings').textContent = formatCurrency(currentData.savingsGoal.weeklyContribution);
                document.getElementById('metric-net').textContent = formatCurrency(currentData.income.combined - processed.totalFixedWeekly - processed.totalActualVariableSpending - currentData.savingsGoal.weeklyContribution);

                // Update Combined Weekly Summary
                document.getElementById('combined-net-pay').textContent = formatCurrency(currentData.income.combined);
                document.getElementById('combined-fixed-expenses').textContent = formatCurrency(processed.totalFixedWeekly);
                document.getElementById('combined-variable-budget').textContent = formatCurrency(processed.totalVariableBudget);
                document.getElementById('combined-actual-variable-spending').textContent = formatCurrency(processed.totalActualVariableSpending);
                document.getElementById('combined-savings-contribution').textContent = formatCurrency(currentData.savingsGoal.weeklyContribution);
                
                const combinedDisposable = currentData.income.combined - processed.totalFixedWeekly - processed.totalActualVariableSpending - currentData.savingsGoal.weeklyContribution;
                document.getElementById('combined-disposable').textContent = formatCurrency(combinedDisposable);

                // Update Combined Weekly Chart
                updateCombinedWeeklySummaryBarChart('combinedWeeklyChart', 
                    ['Net Pay', 'Fixed Expenses', 'Actual Variable Spending', 'Savings', 'Disposable'],
                    [currentData.income.combined, processed.totalFixedWeekly, processed.totalActualVariableSpending, currentData.savingsGoal.weeklyContribution, Math.max(0, combinedDisposable)],
                    ['#22c55e', '#ef4444', '#f97316', '#3b82f6', '#64748b'] 
                );

                const tableBody = document.getElementById('fixed-expenses-table');
                tableBody.innerHTML = '';
                processed.fixedExpensesWeekly
                    .sort((a,b) => b.weekly - a.weekly)
                    .forEach(e => {
                        const row = `
                            <tr class="border-b border-slate-100">
                                <td class="p-3">${e.category}</td>
                                <td class="p-3">${e.provider}</td>
                                <td class="p-3 text-right font-semibold">${formatCurrency(e.weekly)}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });

                const allExpenseCategories = [
                    ...processed.fixedExpensesWeekly.map(e => ({ name: e.category, weekly: e.weekly })), 
                    ...currentData.actualVariableSpendingLog.map(v => ({ name: v.category, weekly: v.amount })) 
                ];
                const aggregatedCategories = allExpenseCategories.reduce((acc, item) => {
                    acc[item.name] = (acc[item.name] || 0) + item.weekly;
                    return acc;
                }, {});

                const expenseCategoriesForChart = Object.entries(aggregatedCategories)
                    .map(([name, weekly]) => ({ name, weekly }))
                    .filter(e => e.weekly && e.weekly > 0)
                    .sort((a, b) => b.weekly - a.weekly)
                    .slice(0, 7); 

                updateBarChart('expensesBarChart', expenseCategoriesForChart.map(e => e.name), expenseCategoriesForChart.map(e => e.weekly));

                const { current, target, weeklyContribution, startDate } = currentData.savingsGoal;
                const progress = target > 0 ? (current / target) * 100 : 0;
                const remaining = Math.max(0, target - current);
                const weeksNeeded = weeklyContribution > 0 ? remaining / weeklyContribution : (remaining > 0 ? Infinity : 0);
                
                const eta = new Date(); 
                if (isFinite(weeksNeeded)) {
                    eta.setDate(eta.getDate() + (weeksNeeded * 7));
                } else {
                    eta.setTime(0); 
                }

                document.getElementById('progress-bar').style.width = `${Math.min(100, Math.round(progress))}%`;
                document.getElementById('progress-bar').textContent = `${Math.round(progress)}%`;
                document.getElementById('savings-current').textContent = formatCurrency(current);
                document.getElementById('savings-target').textContent = formatCurrency(target);
                document.getElementById('savings-remaining').textContent = formatCurrency(remaining);
                document.getElementById('savings-eta').textContent = isFinite(weeksNeeded) ? formatDate(eta) : 'N/A (Adjust Contribution)';
                
                const projectionLabels = [];
                const projectionData = [];

                const chartStartDate = new Date();
                projectionLabels.push(formatDate(chartStartDate));
                projectionData.push(current); 

                let weekCount = 0;
                let currentProjBalance = current;
                let currentProjDate = new Date(chartStartDate); 

                const maxWeeksToProject = 52 * 2; 

                while (weekCount < maxWeeksToProject && (currentProjBalance < target * 1.1 || weekCount < 20)) {
                    currentProjBalance += weeklyContribution;
                    currentProjDate.setDate(currentProjDate.getDate() + 7);
                    
                    projectionLabels.push(formatDate(currentProjDate));
                    projectionData.push(currentProjBalance);
                    
                    weekCount++;
                }

                updateLineChart('savingsLineChart', projectionLabels, projectionData);
            }

            const chartDefaults = {
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        enabled: true,
                        backgroundColor: '#1e293b',
                        titleColor: '#cbd5e1',
                        bodyColor: '#f1f5f9',
                        padding: 10,
                        cornerRadius: 6,
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
            };

            function updateCombinedWeeklySummaryBarChart(canvasId, labels, data, colors) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                if (!ctx) {
                    console.error('Canvas context not found for:', canvasId);
                    return;
                }
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js library not loaded. Cannot create chart.');
                    return;
                }

                if (combinedWeeklyChart) { 
                    combinedWeeklyChart.destroy();
                }

                try {
                    combinedWeeklyChart = new Chart(ctx, { 
                        type: 'bar', 
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Amount',
                                data: data,
                                backgroundColor: colors, 
                                borderRadius: 4,
                            }]
                        },
                        options: {
                            ...chartDefaults,
                            indexAxis: 'y', 
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => formatCurrency(value),
                                    }
                                },
                                y: {
                                    autoSkip: false,
                                    maxRotation: 0,
                                    minRotation: 0
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Error creating/updating combined weekly summary bar chart:', canvasId, error);
                }
            }
            
            function updateBarChart(canvasId, labels, data) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                if (!ctx) {
                    console.error('Canvas context not found for:', canvasId);
                    return;
                }
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js library not loaded. Cannot create chart.');
                    return;
                }

                if (expensesBarChart) {
                    expensesBarChart.destroy();
                }

                try {
                    expensesBarChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Weekly Cost',
                                data: data,
                                backgroundColor: '#4f46e5',
                                borderRadius: 4,
                            }]
                        },
                        options: {
                            ...chartDefaults,
                            indexAxis: 'y',
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => formatCurrency(value),
                                    }
                                },
                                y: {
                                    ticks: {
                                        autoSkip: false,
                                        maxRotation: 0,
                                        minRotation: 0,
                                        callback: function(value, index, values) {
                                            const label = this.getLabelForValue(value);
                                            const maxLength = 16;
                                            if (label.length > maxLength) {
                                                return label.match(new RegExp('.{1,' + maxLength + '}', 'g'));
                                            }
                                            return label;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Error creating/updating bar chart:', canvasId, error);
                }
            }

            function updateLineChart(canvasId, labels, data) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                if (!ctx) {
                    console.error('Canvas context not found for:', canvasId);
                    return;
                }
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js library not loaded. Cannot create chart.');
                    return;
                }

                if (savingsLineChart) {
                    savingsLineChart.destroy();
                }

                try {
                    savingsLineChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Projected Balance',
                                data: data,
                                borderColor: '#4f46e5',
                                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                                fill: true,
                                tension: 0.1,
                                pointRadius: 0
                            }]
                        },
                        options: {
                            ...chartDefaults,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: (value) => formatCurrency(value),
                                    }
                                },
                                x: {
                                    ticks: {
                                        maxRotation: 0,
                                        minRotation: 0,
                                        autoSkip: true,
                                        maxTicksLimit: 6
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('Error creating/updating line chart:', canvasId, error);
                }
            }

            const tabs = document.querySelectorAll('.tab-button');
            const panes = document.querySelectorAll('.tab-pane');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');

                    panes.forEach(pane => {
                        if (pane.id === tab.dataset.tab) {
                            pane.classList.remove('hidden');
                        } else {
                            pane.classList.add('hidden');
                        }
                    });
                });
            });

            document.getElementById('add-fixed-expense-button').addEventListener('click', () => {
                // Default new fixed expenses to 'Weekly'
                createFixedExpenseRow('', '', '', 'Weekly'); 
            });

            document.getElementById('add-actual-saving-button').addEventListener('click', () => {
                const actualAmountInput = document.getElementById('input-weekly-actual-amount');
                const actualDateInput = document.getElementById('input-weekly-actual-date');
                
                const amount = parseFloat(actualAmountInput.value);
                const date = actualDateInput.value || new Date().toISOString().split('T')[0];

                if (!isNaN(amount) && amount > 0) {
                    currentData.savingsGoal.actualSavingsLog.push({ date: date, amount: amount });
                    currentData.savingsGoal.actualSavingsLog.sort((a, b) => new Date(a.date) - new Date(b.date));
                    currentData.savingsGoal.current += amount; // Directly update the running total

                    actualAmountInput.value = '';
                    actualDateInput.value = '';

                    processAndRenderData(currentData);
                    renderActualSavingsLog(); 
                } else {
                    console.warn('Invalid actual saving amount entered. Please enter a positive number.');
                }
            });

            document.getElementById('add-actual-variable-spending-button').addEventListener('click', () => {
                const categoryInput = document.getElementById('input-actual-variable-category');
                const amountInput = document.getElementById('input-actual-variable-amount');
                const dateInput = document.getElementById('input-actual-variable-date');

                const category = categoryInput.value.trim();
                const amount = parseFloat(amountInput.value);
                const date = dateInput.value || new Date().toISOString().split('T')[0];

                if (category && !isNaN(amount) && amount > 0) {
                    currentData.actualVariableSpendingLog.push({ category: category, amount: amount, date: date });
                    currentData.actualVariableSpendingLog.sort((a, b) => new Date(b.date) - new Date(a.date));

                    categoryInput.value = '';
                    amountInput.value = '';
                    dateInput.value = '';

                    processAndRenderData(currentData);
                    renderActualVariableSpendingLog();
                } else {
                    console.warn('Invalid actual variable spending entry. Please fill in category and a positive amount.');
                }
            });

            document.getElementById('reset-variable-spending-button').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all logged actual variable spending for the week? This action cannot be undone.')) {
                    currentData.actualVariableSpendingLog = [];
                    processAndRenderData(currentData);
                    renderActualVariableSpendingLog();
                    console.log('Actual variable spending log reset.');
                }
            });

            // New: Add listener for logging savings used
            document.getElementById('add-savings-used-button').addEventListener('click', () => {
                const amountInput = document.getElementById('input-savings-used-amount');
                const reasonInput = document.getElementById('input-savings-used-reason');
                const dateInput = document.getElementById('input-savings-used-date');
                
                const amount = parseFloat(amountInput.value);
                const reason = reasonInput.value.trim();
                const date = dateInput.value || new Date().toISOString().split('T')[0];

                if (!isNaN(amount) && amount > 0 && reason) {
                    currentData.savingsGoal.actualSavingsUsedLog.push({ date: date, amount: amount, reason: reason });
                    currentData.savingsGoal.actualSavingsUsedLog.sort((a, b) => new Date(a.date) - new Date(b.date));
                    currentData.savingsGoal.current -= amount; // Deduct from running total

                    amountInput.value = '';
                    reasonInput.value = '';
                    dateInput.value = '';

                    processAndRenderData(currentData);
                    renderActualSavingsUsedLog();
                } else {
                    console.warn('Invalid savings used entry. Please fill in amount, reason, and ensure amount is positive.');
                }
            });


            document.getElementById('input-emma-income').addEventListener('input', updateCombinedIncomeInput);
            document.getElementById('input-jordan-income').addEventListener('input', updateCombinedIncomeInput);


            document.getElementById('update-dashboard-button').addEventListener('click', () => {
                console.log('Update Dashboard button clicked');
                const newData = parseInputData();
                processAndRenderData(newData);
            });

            // Function to dynamically move the Savings Goal input section
            function moveSavingsGoalSection() {
                const savingsGoalDiv = document.querySelector('#data-input > div > div:nth-child(2)'); // Selects the 2nd child div of the grid in data-input
                const targetLocation = document.getElementById('savings-goal-input-section');
                if (savingsGoalDiv && targetLocation) {
                    // Create a placeholder div to put the income inputs back into, so income is not also moved.
                    // This approach is more robust than trying to select the exact elements.
                    const incomeSectionContainer = savingsGoalDiv.parentNode; // This is the grid
                    const incomeDiv = incomeSectionContainer.querySelector('div:first-child'); // First child is income

                    // Move income out temporarily to be placed back correctly
                    const tempIncomePlaceholder = document.createElement('div');
                    incomeSectionContainer.insertBefore(tempIncomePlaceholder, incomeDiv);
                    incomeSectionContainer.removeChild(incomeDiv);

                    // Now move the savings goal div to its new location
                    targetLocation.parentNode.insertBefore(savingsGoalDiv, targetLocation.nextSibling); // Insert after targetLocation

                    // Put income back
                    incomeSectionContainer.insertBefore(incomeDiv, tempIncomePlaceholder);
                    incomeSectionContainer.removeChild(tempIncomePlaceholder);
                } else {
                    console.warn('Could not find savings goal section or target location for moving.');
                }
            }


            // Initial render: Populate input fields and then process/render dashboard
            populateFixedExpensesInputs(defaultData.fixedExpenses); 
            populateSavingsGoalInputs(defaultData.savingsGoal); 
            
            updateCombinedIncomeInput(); 
            processAndRenderData(defaultData);
            renderActualSavingsLog(); 
            renderActualSavingsUsedLog(); // Render used savings log
            renderActualVariableSpendingLog(); 

            // Move the savings goal section after initial render
            moveSavingsGoalSection(); 
        });
    </script>
</body>
</html>
